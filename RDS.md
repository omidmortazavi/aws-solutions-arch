# Relational Database Service
## Summary

---
## Notes
- Relational Database Service (RDS)
  - Postgres
  - MySQL
  - MariaDB
  - Oracle
  - MSQL
  - Aurora (AWS proprietary)
- Managed Service
  - Automated provisioning, patching
  - Backup and Point in Time Restore
  - Dashboard
  - Read Replicas
  - Multi AZ
  - Maintenance Windows
  - Scaling
  - Storage backed by EBS
  - Cannot SSH into Instance

- **Backup**
  - **Automated**
    - Daily full backup
    - Transaction logs every 5min
    - 7 Day retention (upto 35d)
  - **DB Snapshot**
    - Manually triggered
    - User defined retention

- **Storage Autoscaling**
  - Horizontal scaling
  - Set Maximum Storage Threshold

- **Read Replicas**
  - Replication is ASYNC so reads are eventually consistent
  - Scalability NOT availability
  - Scale Reads to DB
  - Only support SELECT type commands
  - Upto 5 Replicaes
  - Regionally scoped
  - Replicas can be promoted
  - Application *must* update connection string for replicas
  - No Inter AZ cost for Read Replica within region
  - **Use Cases**
    - Run reporting on read-replicas

- **RDS Multi AZ**
  - SYNC Replication
  - Availability not scalability
  - One *DNS* name
  - Read Replicas can be setup as Multi-AZ for DR
  - Single -> Multi AZ
    - Modify DB, zero downtime operation

- **RDS Security**
  - **Encryption**
    - **At-Rest**
      - Encrypt master & replicas with AWS KMS - AES256
      - Defined at launch
      - If master not encrypted cannot encrypt replicas
    - **In-Flight**
      - SSL Certificate based
      - Provide SSL option with trust cert
      - Enabled in *parameter group*
    - **Operations**
      - Encrypted RDS DB -> Encrypted snapshot
      - Unencrypted RDS DB -> Unencrypted snapshot
      - To Encrypt a DB
        - Create snapshot (unencrypted)
        - Copy and encrypt snapshot
        - Restore DB from encrypted snapshot
        - Migrate apps to new DB, delete old one
  - **Network and IAM**
    - **Network Security**
      - Usually deployed to a private subnet
      - Levarages security groups
    - **Access Manangement**
      - IAM controls who can *manage* RDS instance
      - Traditional username/pw to *login* to db
      - IAM-Based Auth for RDS MySQL and Postgres
        - Auth via token obtained through IAM & RDS API Calls
        - Lifetime of 15mins
        - SSL encrypted

- **Amazon Aurora**
  - Amazon propriety
  - Postgres & MySQL support
  - Cloud optimised
    - 5x faster than MySQL, 3x than Postgres
  - 15 read replicas vs mySQL 5
  - Replication is faster (sub 10ms)
  - Failover is instant, its HA native (faster than RDS Multi-AZ)
  - Costs 20% more than RDS
  - **High Availability**
    - 6 copies of your data across 3 AZ
    - Self healing with peer-to-peer replication
    - Storage Striped across 100s of volumes
      - Horizontally Scaled - 10GB to 64 TB
    - One Instance takes writes (master)
      - *Writer Endpoint*
    - Automated failover of master in less than 30s
    - Master + upto 15 Read Replicas
      - Horizontally scaled
      - *Reader Endpoint* : Connection load balancing
    - Can point to DB directly but recommended to point to *Writer* or *Reader* Endpoint
    - Support for Cross Region Replication
  - **Auto-Scaling**
    - Autoscaling of Reader Replicas (accessed by Reader Endpoint)
  - **Custom Endpoints**
    - Custom Endpoints for each Instance Type
    - Larger Instances for specific use-cases (i.e large query)
    - Reader Endpoint still available but not used generally
  - **Serverless**
    - Automated instantiation and scaling based on usage
  - **Multi-Master**
    - Immediate f/o of writer node (HA)
    - Every node does R/W - vs. promoting RR as new master
  - **Global Aurora**
    - Useful for DR
    - 1 Primary region (R/W)
    - Upto 5 secondary regions(RO)
    - Replication lag is 1s
    - Recommended
    - Promoting another region has RTO of < 1m
  - **Aurora ML**
    - Enables ML-Based predictions to your apps via SQL (i.e recommend products)
    - Aurora sends data to service and receives predictions 
    - Supported on SageMaker (any ML Model) and Comprehend (sentiment analysis)

- **Amazon ElastiCache**
  - *Managed* Redis/Memcached
  - In-Memory database with high perf, low latency
  - Helps off-load db
  - Makes application stateless
    - Application writes session data into Cache, another instance reads retreives session from cache
  - Example
    - Query ElastiCache, if not (CacheMiss) get from RDS and store in Cache
    - Must be Cache invalidation strategy
  - Redis vs. Memchachd
    - **Redis**
      - Replication - HA
      - Mutli AZ with auto f/o
      - Read Replicas with HA
      - Data Durability using AOF Persistance
      - Backup & Restore
    - **Memcached**
      - Sharding - High-Perf, Distributed system
      - Multi-node for sharding
      - No HA
      - Non Persistent
      - No backup & Restore
      - Multi-threaded
  - **Memcache Security**
    - Do not support IAM Auth
    - Support Security Groups
    - Redis AUTH
      - Supports Token
      - Support encryption at rest
      - Supports SSL for in-flight encrption
    - Memcached
      - Supports SASL based auth
  - **Patterns**
    - Lazy Loading - all data cached, can become stale
    - Write Through - Add or update data in cache when written to DB
    - Session Store - Store temp session data in DB using TTL